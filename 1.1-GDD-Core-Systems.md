# GDTLancer - Core Systems (Phase 1)

**Version:** 1.2
**Date:** August 1, 2025
**Related Documents:** 0.1-GDD-Main.md (v1.8), 5.1-GDD-Module-Piloting.md (v1.6), 5.2-GDD-Module-Combat.md (v1.4), 5.3-GDD-Module-Trading.md (v1.1)

## 1. Overview

This document defines the core, cross-cutting gameplay systems required to support the Phase 1 modules (Piloting, Combat, Trading). The definitions and terminology herein are designed to align with the existing project codebase to ensure consistency between design and implementation.

## 2. System Definitions

### System 1: Core Mechanics API
* **Code Reference:** `autoload/CoreMechanicsAPI.gd`
* **Core Responsibility:** To serve as a centralized, global authority for resolving the game's fundamental TTRPG-style dice rolls.
* **Phase 1 Functionality:**
    * Must provide a single, globally accessible function: `perform_action_check(module_modifier, focus_points_spent)`.
    * This function must handle the `3d6` roll, apply the provided modifier and focus point bonus, and return a dictionary containing the final result and outcome tier (e.g., "CritSuccess", "Failure").
* **Interactions:**
    * **Called By:** Any module's "Narrative Action" mode (Piloting, Combat, Trading).
    * **Reads:** `Constants.gd` for outcome thresholds.

### System 2: Event System
* **Code Reference:** `core/systems/event_system.gd` (logic) and `autoload/EventBus.gd` (signaling).
* **Core Responsibility:** To generate and trigger in-game events that transition the player from one gameplay mode to another (e.g., from Free Flight to a Combat Challenge).
* **Phase 1 Functionality:**
    * Must be able to trigger a basic combat encounter event while the player is in the `Free Flight` piloting mode.
    * For Phase 1, this can be implemented as a simple timer that, on expiring, has a chance to fire an "ambush_imminent" signal on the `EventBus`.
* **Interactions:**
    * **Reads:** Player state (e.g., currently in `Free Flight`).
    * **Writes:** Emits signals to the `EventBus` that other systems (like a future "Encounter Manager" or the `WorldManager`) can listen for.

### System 3: Time System
* **Code Reference:** (New System to be created)
* **Core Responsibility:** To manage the passage of abstract game time (`Time Units` or `TU`) and its consequences.
* **Phase 1 Functionality:**
    * Must maintain a global `Time Clock` variable that tracks the current number of `TU`s.
    * Must provide a function to add `TU` to the `Time Clock`.
    * When the `Time Clock` reaches its maximum value, it must:
        1.  Emit a `world_event_tick_triggered` signal on the `EventBus`.
        2.  Call the `Character System` to deduct the periodic `WP` Upkeep cost.
        3.  Reset the `Time Clock` to zero.
* **Interactions:**
    * **Interacts With:**
        * `Piloting Module`: Free Flight mode will call the function to add `TU`.
        * `Trading Module`: Actions like `Seek Rare Goods` will add `TU`.
        * `Character System`: To apply the `WP` Upkeep cost.
        * `EventBus`: To announce the `World Event Tick`.

### System 4: Character System
* **Code Reference:** `core/systems/character_system.gd`
* **Core Responsibility:** To track and manage the core narrative stats, skills, and social standing for the player agent.
* **Phase 1 Functionality:**
    * Must track the player's current **Wealth Points (WP)** and **Focus Points (FP)**.
    * Must provide functions to safely add or subtract `WP` and `FP`.
    * Must contain the player's skill values: `Piloting Skill`, `Tactics Skill`, `Trading Skill`.
    * Must manage the data for narrative stubs, including the player's overall `Reputation` and their `Faction Standing` with various groups.
    * Must have a function to handle the `Upkeep Cost` deduction when called by the `Time System`.
* **Interactions:**
    * **Interacts With:**
        * `Trading Module`: To modify the player's `WP` total.
        * `Combat/Piloting Modules`: To retrieve skill values for calculating `Module Modifiers`.
        * `Time System`: Receives the call to deduct `WP` for upkeep.
        * `GameStateManager`: Provides player stat data for saving and loading.

### System 5: Inventory System
* **Code Reference:** (New System to be created)
* **Core Responsibility:** To manage the contents of an agent's cargo hold.
* **Phase 1 Functionality:**
    * Must define a basic data structure for a commodity (e.g., a `Resource` with properties for ID, name, base value).
    * Must maintain a list or dictionary of commodities currently held by the player.
    * Must provide functions to `addItem(item, quantity)` and `removeItem(item, quantity)`.
    * All inventory modifications must respect the `Cargo Capacity` stat of the player's ship.
* **Interactions:**
    * **Interacts With:**
        * `Trading Module`: The Trade Interface will call this system's functions to modify the player's inventory during transactions.
        * `Asset System`: To retrieve the player ship's `Cargo Capacity`.

### System 6: Asset System
* **Code Reference:** `core/systems/asset_system.gd`
* **Core Responsibility:** To track and manage an agent's major, non-consumable assets (specifically the ship in Phase 1) and their associated stats and conditions.
* **Phase 1 Functionality:**
    * Must define a basic data structure for a Ship Asset (e.g., a `Resource`) that contains all relevant stats.
    * Must maintain a reference to the player's currently active ship asset.
    * Must provide getter functions for other systems to query the current ship's stats (e.g., `get_player_ship_stat("CargoCapacity")`).
    * Must manage the data for the **Ship Quirks** narrative stub, including a list of active quirks on the player's ship.
* **Interactions:**
    * **Interacts With:**
        * `Inventory System`: Provides the `Cargo Capacity` stat.
        * `Combat Module`: Provides stats like `Hull Integrity`, `Shields`, and `Weapon Systems`.
        * `Piloting Module`: Provides stats like `Mass`, `Agility`, and `Thruster Power`.
